!function(e){"use strict";e.fn.ajaxlivesearch=function(a){function s(e,a){e.hide(),a.find("table").addClass("border_radius")}function t(e,a){a.find("table").removeClass("border_radius"),e.show()}function l(e){var a,s,t=e.find("option");for(s=0;s<t.length;s+=1)void 0===a&&0!==parseInt(t[s].value)?a=t[s].value:parseInt(t[s].value)<parseInt(a)&&0!==parseInt(t[s].value)&&(a=t[s].value);return a}function r(e,a,s){if(void 0===e||void 0===s)throw"Form or Options is missing";var t="."+s.current_page_hidden_class;switch(a){case"result":return e.find("."+s.result_wrapper_class);case"footer":return e.find("."+s.footer_class);case"arrow":return e.find("."+s.arrow_class);case"navigation":return e.find("."+s.navigation_class);case"current_page":return e.find(t);case"current_page_lbl":return e.find("."+s.current_page_lbl_class);case"total_page_lbl":return e.find("."+s.total_page_lbl_class);case"page_range":return e.find("."+s.page_range_class);default:throw"Key: "+a+" is not found"}}function n(e,a){e.slideUp(a.slide_speed)}function i(e,a){e.slideDown(a.slide_speed)}function o(a,o,_,d,u){var p=r(o,"result",_);if(e.trim(a.value).length){if(d||a.latest_value!==a.value){if(u){var v=r(o,"current_page",_),f=r(o,"current_page_lbl",_);v.val("1"),f.html("1")}a.selected_row=void 0,a.to_be_executed&&clearTimeout(a.to_be_executed),a.to_be_executed=setTimeout(function(){if(e.trim(a.value).length){e(a).addClass("ajax_loader");var n=r(o,"navigation",_),d=r(o,"total_page_lbl",_),u=r(o,"page_range",_),v=r(o,"footer",_);e.ajax({type:"post",url:c.url,data:e(o).serialize(),dataType:"json",cache:c.cache,success:function(a){if("success"===a.status){var r=e.parseJSON(a.result);if(p.find("table tbody").html(r.html),0===r.number_of_results)s(v,p);else{r.total_pages>1?(n.show(),d.html(r.total_pages)):n.hide();var i=l(u);v.is(":visible")?parseInt(r.number_of_results)<=parseInt(i)?s(v,p):t(v,p):parseInt(r.number_of_results)>parseInt(i)?t(v,p):s(v,p)}}else p.find("table tbody").html(a.message),s(v,p)},error:function(){p.find("table tbody").html("Something went wront. Please refresh the page."),s(v,p)},complete:function(s){if(e.trim(a.value).length&&p.is(":hidden")&&i(p,_),e(a).removeClass("ajax_loader"),void 0!==_.onAjaxComplete){var t={"this":this};_.onAjaxComplete(s,t)}}})}},c.type_delay)}}else(p.is(":visible")||p.is(":animated"))&&n(p,_);a.latest_value=a.value}function _(e,a){var s=e.attr("id");e.attr("placeholder",a.placeholder),e.attr("autocomplete","off"),e.attr("name","ls_query"),e.addClass("ls_query"),e.attr("maxlength",a.max_input);var t,l,r,n="",i="";for(t=0;t<a.page_ranges.length;t+=1)r=a.page_ranges[t],i=0===r?"All":r,l=a.page_range_default===r?"selected":"",n+='<option value="'+r+'" '+l+">"+i+"</option>";var o='<div class="'+a.footer_class+'"><div class="col '+a.page_limit+'"><select name="ls_items_per_page" class="'+a.page_range_class+'">'+n+'</select></div><div class="col '+a.navigation_class+'"><i class="icon-left-circle '+a.arrow_class+" "+a.previous_page_class+'"></i></div><div class="col '+a.navigation_class+" "+a.pagination_class+'"><label class="'+a.current_page_lbl_class+'">1</label> / <label class="'+a.last_page_lbl_class+'"></label></div><div class="col '+a.navigation_class+'"><i class="icon-right-circle '+a.arrow_class+" "+a.next_page_class+'"></i></div></div>',_='<div class="'+a.container_class+'"><form accept-charset="UTF-8" class="'+a.form_class+'" id="'+a.form_class+"_"+s+'" name="ls_form"></form></div>',c='<input type="hidden" name="ls_anti_bot" class="'+a.form_anti_bot_class+'" value=""><input type="hidden" name="ls_token" class="'+a.token_class+'" value="'+a.token+'"><input type="hidden" name="ls_page_loaded_at" class="'+a.loaded_at_class+'" value="'+a.loaded_at+'"><input type="hidden" name="ls_current_page" class="'+a.current_page_hidden_class+'" value="1"><input type="hidden" name="ls_query_id" value="'+s+'">',d='<div class="'+a.result_wrapper_class+'"><div class="'+a.result_class+'"><table><tbody></tbody></table></div>'+o+"</div>";e.wrap(_),e.before(c),e.after(d)}if(void 0===a.loaded_at)throw"loaded_at must be defined";if(void 0===a.token)throw"token must be defined";var c={url:"ajax/process_livesearch.php",form_anti_bot:"ajaxlivesearch_guard",cache:!1,form_anti_bot_class:"ls_anti_bot",footer_class:"ls_result_footer",next_page_class:"ls_next_page",previous_page_class:"ls_previous_page",page_limit:"page_limit",result_wrapper_class:"ls_result_div",result_class:"ls_result_main",container_class:"ls_container",pagination_class:"pagination",form_class:"search",loaded_at_class:"ls_page_loaded_at",token_class:"ls_token",current_page_hidden_class:"ls_current_page",current_page_lbl_class:"ls_current_page_lbl",last_page_lbl_class:"ls_last_page_lbl",total_page_lbl_class:"ls_last_page_lbl",page_range_class:"ls_items_per_page",page_ranges:[0,5,10],page_range_default:5,navigation_class:"navigation",arrow_class:"arrow",slide_speed:"fast",type_delay:350,placeholder:"Type to start searching",max_input:20};return c=e.extend(c,a),this.each(function(){var s=e(this),t=s.attr("id");_(s,c);var l=e("#"+c.form_class+"_"+t),d=r(l,"result",c),u=r(l,"arrow",c),p=r(l,"current_page",c),v=r(l,"current_page_lbl",c),f=r(l,"total_page_lbl",c),h=r(l,"page_range",c);s.on("keyup",function(t){var r=t.keyCode||t.which;if(e.trim(s.val()).length&&13===r){if(!d.is(":visible")&&!d.is(":animated")||0===parseInt(d.find("tr").length))i(d,c);else if(void 0!==s.selected_row){var n={selected:e(s.selected_row),"this":this};void 0!==a.onResultEnter&&a.onResultEnter(t,n)}}else o(this,l,c,!1,!0)}),s.on("keydown",function(a){var t=a.keyCode||a.which;return 40===t||38===t?(e.trim(s.val()).length&&0!==d.find("tr").length&&(d.is(":visible")||d.is(":animated")?(d.find("tr").removeClass("hover"),void 0===s.selected_row?(s.selected_row=d.find("tr").eq(0),e(s.selected_row).addClass("hover")):(e(s.selected_row).removeClass("hover"),40===t?0===e(s.selected_row).next().length?(s.selected_row=d.find("tr").eq(0),e(s.selected_row).addClass("hover")):(e(s.selected_row).next().addClass("hover"),s.selected_row=e(s.selected_row).next()):0===e(s.selected_row).prev().length?(s.selected_row=d.find("tr").last(),s.selected_row.addClass("hover")):(e(s.selected_row).prev().addClass("hover"),s.selected_row=e(s.selected_row).prev()))):40===t&&i(d,c)),!1):void 0}),s.on("focus",function(){e.trim(s.val()).length&&(d.is(":hidden")||d.is(":animated"))&&0!==d.find("tr").length&&(o(this,l,c,!1,!0),i(d,c))}),d.on("mouseover","tr",function(){d.find("tr").removeClass("hover"),s.selected_row=this,e(this).addClass("hover")}),d.on("mouseleave","tr",function(){d.find("tr").removeClass("hover"),s.selected_row=void 0}),l.submit(function(){return!1}),u.on("click",function(){var a;if(e(this).hasClass(c.next_page_class)){if(!(parseInt(p.val(),10)+1<=parseInt(f.html(),10)))return;a=parseInt(p.val(),10)+1}else{if(!(parseInt(p.val(),10)-1>=1))return;a=parseInt(p.val(),10)-1}p.val(a),v.html(a),o(s[0],l,c,!0,!1)}),h.on("change",function(){o(s[0],l,c,!0,!0)}),d.css({left:s.position().left+1,width:s.outerWidth()-2}),e(window).resize(function(){d.css({left:s.position().left+1,width:s.outerWidth()-2})});var g;e(document).bind("touchstart",function(){g=e(window).scrollTop()}).bind("touchend",function(a){var t,l;t=g-e(window).scrollTop(),l=e(document),l.addClass("touched"),10>t&&t>-10&&(e(a.target).closest(d).length||e(a.target).is(s)||!e(d).is(":visible")||n(d,c))}),e(document).on("click",function(a){e(this).hasClass("touched")?e(this).removeClass("touched"):e(a.target).closest(d).length||e(a.target).is(s)||!e(d).is(":visible")||n(d,c)}),e(d).on("click","tr",function(t){var l={selected:e(s.selected_row),"this":this};void 0!==a.onResultClick&&a.onResultClick(t,l)}),e(this).on("ajaxlivesearch:hide_result",function(){n(d,c)}),e(this).on("ajaxlivesearch:search",function(a,s){e(this).val(s.query),o(this,l,c,!0,!0)})}),e("."+c.form_anti_bot_class).val(c.form_anti_bot),this}}(jQuery);